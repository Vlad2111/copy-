логин и пароль.
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Выносной Контроллер</title>
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <link rel="stylesheet" href="/bootstrap.min.css">
    <link rel="stylesheet" href="/font-awesome.min.css">
    <link rel="stylesheet" href="/AdminLTE.min.css">
</head>
<body class="hold-transition login-page" style="min-height:0;">
<div class="login-box">
    <div class="login-logo" style="color:#777777">
        <b>В</b>ыносной <b>К</b>онтроллер
    </div>
    <div class="login-box-body">
        <form method="POST" action="/authorizeprocess" style="margin:0px">
            <div class="form-group has-feedback">
                <input id="login" name="login" type="text" class="form-control" placeholder="Логин">
                <span class="glyphicon glyphicon-user form-control-feedback"></span>
            </div>
            <div class="form-group has-feedback">
                <input id="password" name="password" type="password" class="form-control" placeholder="Пароль">
                <span class="glyphicon glyphicon-lock form-control-feedback"></span>
            </div>
            <div class="row">
                <div class="col-xs-8">
                </div>
                <div class="col-xs-4">
                    <input type="submit" class="btn btn-primary btn-block btn-flat" value="Войти"></input>
                </div>
            </div>
        </form>
    </div>
    <div class="login-logo">
        <img src="/TecomLogo.png" class="user-image" alt="User Image" style="margin-top:20px">
    </div>
</div>

</body>
</html>


основная страница


<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
        <link rel="stylesheet" href="/bootstrap.min.css">
        <script type="text/javascript" src="/jquery-2.2.0.min.js"></script>
        <link rel="stylesheet" href="/AdminLTE.min.css">
        <link rel="stylesheet" href="/skin-blue.min.css">
        <link rel="stylesheet" href="/font-awesome.min.css">
        <script src="/bootstrap.min.js"></script>
        <link rel="stylesheet" href="/dataTables.bootstrap.css">
        <script src="/app.min.js"></script>
        <title>Выносной контроллер</title>
        <style>
            .user:hover{
            outline:none;text-decoration:none;border-left: 3px solid transparent !important; background-color: #222d32 !important;color: #b8c7ce !important
            }
            .smallName{
            padding-right: 10px;
            }
        </style>
    </head>

<body class="hold-transition skin-blue sidebar-mini">
    <div class="wrapper">
        <header class="main-header">
            <a class="logo">
                <span class="logo-mini"><b>BK</b></span>
                <span class="logo-lg" style="font-size: 19px">Выносной Контроллер</span>
            </a>

            <nav class="navbar navbar-static-top" role="navigation">
                <a class="sidebar-toggle" data-toggle="offcanvas" role="button">
                <span class="glyphicon glyphicon-resize-horizontal"></span>
                </a>

                <div class="navbar-custom-menu">
                    <ul class="nav navbar-nav">
                        <img src="/TecomLogo.png" class="user-image" alt="User Image" style="margin-top: 10px; margin-right: 30px;">
                    </ul>
                </div>
            </nav>
        </header>
        <aside class="main-sidebar">
            <section class="sidebar">
                <div class="user-panel"></div>
                <ul class="sidebar-menu">
                    <li class="active"><a href="/"><b class="smallName">АГ</b><span>Агенты</span></a></li>
                    <li ><a href="/instances"><b class="smallName">ЭК</b><span>Экземпляры</span></a></li>
                    <li ><a href="/buildinfo"><b class="smallName">ВП</b><span>Версия ПО</span></a></li>
                    <li ><a href="/systeminfo"><b class="smallName">ИС</b><span>Информация о системе</span></a></li>
                </ul>
                <ul class="sidebar-menu" style="position: fixed; bottom:0;">
                    <li><a class="user"><i class="glyphicon glyphicon-user" aria-hidden="true"></i><span>Пользователь: admin</span></a></li>
                    <li><a class="user" href="/authorization?action=exit"><i class="glyphicon glyphicon-log-out" aria-hidden="true"></i> <span>Выход</span></a></li>
                </ul>
            </section>
        </aside>

        <div class="content-wrapper">
            <section class="content">
<style type="text/css">
hr{ 
    margin: 7px;
}
.bar {
    height: 18px; 
    background: green;
}
</style>

<div class="box box-primary">
    <div class="box-header">
        <h3 class="box-title">Агенты</h3>
    </div>
    <div class="box-body">
        <table id="agents" class="table table-bordered table-striped">
            <thead>
                <tr>
                    <th>Имя</th>
                    <th>Название</th>
                    <th>Версия</th>
                    <th>Тип</th>
                    <th>Описание</th>
                    <th>Конфигурация по умолчанию</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                
                    <tr>
                        <td>dukGenericDryContacts</td>
                        <td>JS Generic dry contacts agent</td>
                        <td>1.0.0.1</td>
                        <td>javascript-Duktape</td>
                        <td></td>
                        <td>{
  "contacts" : [
    {
      "config" : "MiRageNDIC:192.168.1.1:502:DI0",
      "displayName" : "Окно",
      "expectedValue" : 0,
      "name" : "inContact1"
    },
    {
      "config" : "MK1104K4R:\/dev\/ttyUSB4:16:DI0",
      "displayName" : "Дверь",
      "expectedValue" : 0,
      "name" : "inContact2"
    }
  ],
  "createAlertIfContactIsChanged" : 0
}</td>
                        <td><a style="style:none;" title="Добавить экземпляр" onclick="showModal('dukGenericDryContacts')"><span class="glyphicon glyphicon-plus"></span></a></td>
                    </tr>
                
                    <tr>
                        <td>genericDryContacts</td>
                        <td>Generic dry contacts agent</td>
                        <td>1.0.0.1</td>
                        <td>native</td>
                        <td></td>
                        <td>{
  "contacts" : [
    {
      "config" : "MiRageNDIC:192.168.1.1:502:DI0",
      "displayName" : "Window",
      "expectedValue" : 0,
      "name" : "inContact1"
    },
    {
      "config" : "MK1104K4R:\/dev\/ttyUSB4:16:DI0",
      "displayName" : "Door",
      "expectedValue" : 0,
      "name" : "inContact2"
    }
  ],
  "createAlertIfContactIsChanged" : 0
}</td>
                        <td><a style="style:none;" title="Добавить экземпляр" onclick="showModal('genericDryContacts')"><span class="glyphicon glyphicon-plus"></span></a></td>
                    </tr>
                
                    <tr>
                        <td>РЕКО-ВЕК-КаналТ</td>
                        <td>Javascript агент для РЕКО-ВЕК КаналТ</td>
                        <td>1.0.0.1</td>
                        <td>javascript-Duktape</td>
                        <td></td>
                        <td>{
  "logDirectory" : "\/home\/rdc\/rdc_test\/rdc\/public\/"
}</td>
                        <td><a style="style:none;" title="Добавить экземпляр" onclick="showModal('РЕКО-ВЕК-КаналТ')"><span class="glyphicon glyphicon-plus"></span></a></td>
                    </tr>
                
            </tbody>
        </table>
        <a id="refreshBtn" type="button" class="btn btn-md" title="Обновить список"><i class="glyphicon glyphicon-refresh"></i></a>
        <a id="deleteBtn" type="button" class="btn btn-md" title="Удалить агент"><i class="glyphicon glyphicon-trash"></i></a>
    </div>
</div>
<div id="alertMsg" class="alert alert-dismissible fade in" role="alert" style="display:none;">
</div>
<div class="modal fade" id="createInstance" tabindex="-1" role="dialog" aria-labelledby="createLabel">
<div class="modal-dialog" role="document">
    <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="createLabel">Создать экземпляр</h4>
        </div>
        <form method="post" id="formCreate" action="javascript:void(null);">    
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-3"><b>Тип</b></div>
                    <div class="col-md-9"><label id="type" name="type"></label></div>
                </div>
                <hr>
                <div class="row">
                    <div class="col-md-3"><b>Название</b></div>
                    <div class="col-md-9"><input id="name" name="name" type="text" class="form-control pull-right" required></div>
                </div>
                <hr>
                <div class="row">
                    <div class="col-md-3"><b>Описание</b></div>
                    <div class="col-md-9"><textarea id="description" name="description" class="form-control pull-right" style="resize: vertical"></textarea></div>
                </div>
                <hr>
                <div class="row">
                    <div class="col-md-6"><input id="autostart" name="autostart" type="checkbox"> <label for="autostart"><b>Авто старт</b></label></div>
                    <div class="col-md-6"><input id="debug" name="debug" type="checkbox"><label for="debug"><b> Отладка</b></label></div>
                </div>
                <hr>
                <div class="row">
                    <div class="col-md-3"><b>Конфигурация</b></div>
                    <div class="col-md-9"><textarea id="config" name="config" rows='8' class="form-control pull-right" style="resize: vertical" required> {
}</textarea></div>
                </div>
                <hr>
                <div class="row">
                    <div class="col-md-3"><b>Конфигурация журнала</b></div>
                    <div class="col-md-9"><textarea id="logConfig" name="logConfig" rows='8' class="form-control pull-right" style="resize: vertical" required>
{
    "logLevel": "information",
    "formatter":
    {
        "pattern": "%Y-%m-%d %H:%M:%S %s: [%p] %t",
        "times": "local" 
    },
    "channel":
    {
        "rotation": "20M",
        "archive": "number",
        "compress": "true",
        "purgeCount": "5" 
    }
}</textarea></div>
                </div>
            </div>
        <div class="modal-footer">
            <a data-dismiss="modal" class="btn btn-primary pull-right" style="margin-left:3px; margin-right:3px;"><b>Отмена</b></a>
            <input type="submit" id="createAndStartBtn" value="Создать и запустить" class="btn btn-primary pull-right" style="margin-left:3px; margin-right:3px;">
            <input type="submit" id="createBtn" value="Создать" class="btn btn-primary pull-right" style="margin-left:3px; margin-right:3px;">
        </div>
        </form>
    </div>
</div>
</div>



<script src="/jquery.dataTables.min.js"></script>
<script src="/dataTables.bootstrap.min.js"></script>
<script>
$(document).ready(function() {
    var table = $("#agents").DataTable({
        "columns": [
            { "data": "NAME", "visible": false },
            { "data": "DISPLAYNAME" },
            { "data": "VERSION" },
            { "data": "TYPE" },
            { "data": "DESCRIPTION" },
            { "data": "CONFIG", "visible": false },
            { "data": "ADD_BUTTON", "orderable": false }
        ],
        "language": {
            "lengthMenu": "Показать _MENU_ элементов",
            "zeroRecords": "Ничего не найдено",
            "info": "С _START_ по _END_ из _TOTAL_",
            "infoEmpty": "Нет доступных данных",
            "infoFiltered": "(Отфильтровано из _MAX_ записей)",
            "paginate": {
                "first":      "Первый",
                "last":       "Последний",
                "next":       "Следующая",
                "previous":   "Предыдущая"
            },
            "loadingRecords": "Загрузка...",
            "processing":     "Обработка...",
            "search":         "Поиск:"
        }
    });

    $('#agents tbody').on( 'click', 'tr', function () {
        $(this).toggleClass('active');
    });
    
   $('#refreshBtn').click(function() {
        $.ajax({
            type: "GET",
            url: "/agentslist",
            contentType: "application/x-www-form-urlencoded",
            async: true,
            success: function (data) {
                if (data.ERROR) {
                    $('#alertMsg').empty();
                    $('#alertTmpl').tmpl(data).appendTo('#alertMsg');
                    $('#alertMsg').show();
                    return;
                }

                var rowsData = data.agents.map(function(item) {
                    item.ADD_BUTTON =
                        "<a style=\"style:none;\" title=\"Добавить экземпляр\" onclick=\"showModal(" +
                        "'" + item.NAME + "'" +
                        ")\"><span class=\"glyphicon glyphicon-plus\"></span></a>";
                    return item;
                });


                table.clear();
                table.rows.add(rowsData).draw(false);

                var pageInfo = table.page.info();
                if (pageInfo.page == pageInfo.pages) {
                    table.page('last').draw(false);
                }
            },
            error: function() {
                var errMsg = { "ERROR": "Ошибка при получении данных с сервера" };
                $('#alertMsg').empty();
                $('#alertTmpl').tmpl(errMsg).appendTo('#alertMsg');
                $('#alertMsg').show();
            }
        });
    });

    $('#deleteBtn').click(function() {
        var selectedNames = $.makeArray(table.rows('.active').data().map(function(dataRow) {
            return dataRow.NAME;
        }));

        if (!selectedNames.length) {
            return;
        }
        
        if (!confirm("Подтвердите, пожалуйста, удаление выбранных классов агентов.")) {
            return;
        }

        var jsonString = JSON.stringify({
            names: selectedNames
        });

        $.ajax({
            type: "POST",
            url: "/removeagent",
            data: jsonString,
            contentType: "application/x-www-form-urlencoded",
            async: true,
            success: function (data) {
                var errors = [];
                $.each(data, function(key, value){
                    if (value != "true") {
                        errors.push(key + ": " + value);
                    }
                });
                
                if (errors.length) {
                    var errMsg = { "ERROR": errors.join("\n") };
                    $('#alertMsg').empty();
                    $('#alertTmpl').tmpl(errMsg).appendTo('#alertMsg');
                    $('#alertMsg').show();
                } else {
                    $('#alertMsg').hide();
                }
                $('#refreshBtn').click();
            },
            error: function(data) {
                var errMsg = { "ERROR": "Ошибка при получении данных с сервера\n" + data };
                $('#alertMsg').empty();
                $('#alertTmpl').tmpl(errMsg).appendTo('#alertMsg');
                $('#alertMsg').show();
            },
            complete: function() {
                $('#refreshBtn').click();
            }
        });
    });

    $('#formCreate').submit(function(event) {
        $('#createBtn').prop("disabled", true);
        $('#createAndStartBtn').prop("disabled", true);

        var mg = {
            type: document.getElementById("type").innerHTML,
            name: $("#name").val(),
            description: $("#description").val(),
            autostart: document.getElementById("autostart").checked,
            debug: document.getElementById("debug").checked,
            config: $("#config").val(),
            logConfig: $("#logConfig").val(),
            startNow: document.activeElement.id == "createAndStartBtn"  
        };
        var jsonString = JSON.stringify(mg);
        var request = new XMLHttpRequest();
        request.open('POST', '/createinstance', true);
        request.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
        request.onload = function() {
            var resp = request.responseText;
            if(resp == "true") {
                showSuccess();
            } else {
                showError(resp);
            }
        }
        request.onerror = function() {
            showError();
        }
        request.send(jsonString);
    });
    
    function showSuccess() {
        $('#alertMsg').removeClass('alert-danger');
        $('#alertMsg').addClass('alert-success');
        document.getElementById('alertMsg').innerHTML = '<a class="close" data-dismiss="alert" href="#">&times;</a>' +
        'Экземпляр  ' + document.getElementById("type").innerHTML + ' успешно создан';
        $('#alertMsg').show();
        $("#createInstance").modal('hide');
        $('#formCreate').trigger( 'reset' );
    }

    function showError(data) {
        $('#alertMsg').addClass('alert-danger');
        $('#alertMsg').removeClass('alert-success');
        document.getElementById('alertMsg').innerHTML = '<a class="close" data-dismiss="alert" href="#">&times;</a>' +
        'Возникла ошибка при создании экземпляра: ' + data;
        $('#alertMsg').show();
        $("#createInstance").modal('hide');
        $('#formCreate').trigger( 'reset' );
    }

});

    function showModal(name) {
        var table = $('#agents').DataTable();
        
        // TODO: fix the code below
        // it doesn't work in case of sorting
        // the returned index is correct - selected row in case of sorted table or not 
        // however, data array itself is not sorted =\
        // cache() method returnes undefined value by unknown reason
        //var index = table.column(0).data().indexOf(name);
        //if (index < 0) {
        //    return;
        //}
        //config = table.cell(index, 5).data();
        
        // use workaround
        var config;
        table.rows().every( function ( rowIdx, tableLoop, rowLoop ) {
            var data = this.data();
            if (data.NAME == name) {
                config = data.CONFIG;
                // return ?
            }
        } );

        document.getElementById("type").innerHTML = name;
        document.getElementById("config").innerHTML = config;

        $('#createBtn').prop("disabled", false);
        $('#createAndStartBtn').prop("disabled", false);
        $("#createInstance").modal('show');
    }
</script>
<link rel="stylesheet" href="/css/jquery.fileupload.css">
<script src="js/vendor/jquery.ui.widget.js"></script>
<script src="js/jquery.iframe-transport.js"></script>
<script src="js/jquery.fileupload.js"></script>
<script src="/jquery.tmpl.js" type="text/javascript"></script>
<script id="installSuccess" type="text/x-jquery-tmpl">
<div>
    <i class="glyphicon glyphicon-ok text-green"></i>&nbsp;${FILE}
</div>
</script>
<script id="installError" type="text/x-jquery-tmpl">
<div>
    <i class="glyphicon glyphicon-remove text-red"></i>&nbsp;${FILE}&nbsp;-&nbsp;${ERROR}
</div>
</script>
<script id="alertTmpl" type="text/x-jquery-tmpl">
    <div class="alert alert-danger alert-dismissible">
        <h4><i class="glyphicon glyphicon-ban-circle"></i> Ошибка!</h4>
<pre class="alert alert-danger">${ERROR}</pre>
    </div>
</script>
<span class="btn btn-success fileinput-button">
    <i class="glyphicon glyphicon-plus"></i>
    <span>Установить агенты...</span>
    <input id="fileupload" type="file" name="files[]" data-url="/installagent" multiple>
</span>
<div id="progress">
    <div class="bar" style="width: 0%"></div>
</div>
<div id="installResults">
</div>
<script>
$(function () {
    $('#fileupload').fileupload({
        dataType: 'json',
        sequentialUploads: true,
        progressall: function (e, data) {
            var progress = parseInt(data.loaded / data.total * 100, 10);
            $('#progress .bar').css('width', progress + '%');
        },
        start: function(e) {
            $('#fileupload').prop("disabled", true);
            $('#installResults').empty();
        },
        stop: function(e) {
            $('#fileupload').prop("disabled", false);
            $('#refreshBtn').click();
        },
        always: function (e, data) {
            var response = jQuery.parseJSON(data.jqXHR.responseText);
            if (response.success) {              
                $('#installSuccess').tmpl({"FILE": data.files[0].name}).appendTo('#installResults');
            } else {
                $('#installError').tmpl({"FILE": data.files[0].name, "ERROR": response.error}).appendTo('#installResults');
            }
        }
    });
});
</script>
			</div><!-- /.content-wrapper -->
	    </section><!-- ./content -->
    </div><!-- ./wrapper -->
  </body>
</html>


выплывающий 


<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
        <link rel="stylesheet" href="/bootstrap.min.css">
        <script type="text/javascript" src="/jquery-2.2.0.min.js"></script>
        <link rel="stylesheet" href="/AdminLTE.min.css">
        <link rel="stylesheet" href="/skin-blue.min.css">
        <link rel="stylesheet" href="/font-awesome.min.css">
        <script src="/bootstrap.min.js"></script>
        <link rel="stylesheet" href="/dataTables.bootstrap.css">
        <script src="/app.min.js"></script>
        <title>Выносной контроллер</title>
        <style>
            .user:hover{
            outline:none;text-decoration:none;border-left: 3px solid transparent !important; background-color: #222d32 !important;color: #b8c7ce !important
            }
            .smallName{
            padding-right: 10px;
            }
        </style>
    </head>

<body class="hold-transition skin-blue sidebar-mini">
    <div class="wrapper">
        <header class="main-header">
            <a class="logo">
                <span class="logo-mini"><b>BK</b></span>
                <span class="logo-lg" style="font-size: 19px">Выносной Контроллер</span>
            </a>

            <nav class="navbar navbar-static-top" role="navigation">
                <a class="sidebar-toggle" data-toggle="offcanvas" role="button">
                <span class="glyphicon glyphicon-resize-horizontal"></span>
                </a>

                <div class="navbar-custom-menu">
                    <ul class="nav navbar-nav">
                        <img src="/TecomLogo.png" class="user-image" alt="User Image" style="margin-top: 10px; margin-right: 30px;">
                    </ul>
                </div>
            </nav>
        </header>
        <aside class="main-sidebar">
            <section class="sidebar">
                <div class="user-panel"></div>
                <ul class="sidebar-menu">
                    <li class="active"><a href="/"><b class="smallName">АГ</b><span>Агенты</span></a></li>
                    <li ><a href="/instances"><b class="smallName">ЭК</b><span>Экземпляры</span></a></li>
                    <li ><a href="/buildinfo"><b class="smallName">ВП</b><span>Версия ПО</span></a></li>
                    <li ><a href="/systeminfo"><b class="smallName">ИС</b><span>Информация о системе</span></a></li>
                </ul>
                <ul class="sidebar-menu" style="position: fixed; bottom:0;">
                    <li><a class="user"><i class="glyphicon glyphicon-user" aria-hidden="true"></i><span>Пользователь: admin</span></a></li>
                    <li><a class="user" href="/authorization?action=exit"><i class="glyphicon glyphicon-log-out" aria-hidden="true"></i> <span>Выход</span></a></li>
                </ul>
            </section>
        </aside>

        <div class="content-wrapper">
            <section class="content">
<style type="text/css">
hr{ 
    margin: 7px;
}
.bar {
    height: 18px; 
    background: green;
}
</style>

<div class="box box-primary">
    <div class="box-header">
        <h3 class="box-title">Агенты</h3>
    </div>
    <div class="box-body">
        <table id="agents" class="table table-bordered table-striped">
            <thead>
                <tr>
                    <th>Имя</th>
                    <th>Название</th>
                    <th>Версия</th>
                    <th>Тип</th>
                    <th>Описание</th>
                    <th>Конфигурация по умолчанию</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                
                    <tr>
                        <td>dukGenericDryContacts</td>
                        <td>JS Generic dry contacts agent</td>
                        <td>1.0.0.1</td>
                        <td>javascript-Duktape</td>
                        <td></td>
                        <td>{
  "contacts" : [
    {
      "config" : "MiRageNDIC:192.168.1.1:502:DI0",
      "displayName" : "Окно",
      "expectedValue" : 0,
      "name" : "inContact1"
    },
    {
      "config" : "MK1104K4R:\/dev\/ttyUSB4:16:DI0",
      "displayName" : "Дверь",
      "expectedValue" : 0,
      "name" : "inContact2"
    }
  ],
  "createAlertIfContactIsChanged" : 0
}</td>
                        <td><a style="style:none;" title="Добавить экземпляр" onclick="showModal('dukGenericDryContacts')"><span class="glyphicon glyphicon-plus"></span></a></td>
                    </tr>
                
                    <tr>
                        <td>genericDryContacts</td>
                        <td>Generic dry contacts agent</td>
                        <td>1.0.0.1</td>
                        <td>native</td>
                        <td></td>
                        <td>{
  "contacts" : [
    {
      "config" : "MiRageNDIC:192.168.1.1:502:DI0",
      "displayName" : "Window",
      "expectedValue" : 0,
      "name" : "inContact1"
    },
    {
      "config" : "MK1104K4R:\/dev\/ttyUSB4:16:DI0",
      "displayName" : "Door",
      "expectedValue" : 0,
      "name" : "inContact2"
    }
  ],
  "createAlertIfContactIsChanged" : 0
}</td>
                        <td><a style="style:none;" title="Добавить экземпляр" onclick="showModal('genericDryContacts')"><span class="glyphicon glyphicon-plus"></span></a></td>
                    </tr>
                
                    <tr>
                        <td>РЕКО-ВЕК-КаналТ</td>
                        <td>Javascript агент для РЕКО-ВЕК КаналТ</td>
                        <td>1.0.0.1</td>
                        <td>javascript-Duktape</td>
                        <td></td>
                        <td>{
  "logDirectory" : "\/home\/rdc\/rdc_test\/rdc\/public\/"
}</td>
                        <td><a style="style:none;" title="Добавить экземпляр" onclick="showModal('РЕКО-ВЕК-КаналТ')"><span class="glyphicon glyphicon-plus"></span></a></td>
                    </tr>
                
            </tbody>
        </table>
        <a id="refreshBtn" type="button" class="btn btn-md" title="Обновить список"><i class="glyphicon glyphicon-refresh"></i></a>
        <a id="deleteBtn" type="button" class="btn btn-md" title="Удалить агент"><i class="glyphicon glyphicon-trash"></i></a>
    </div>
</div>
<div id="alertMsg" class="alert alert-dismissible fade in" role="alert" style="display:none;">
</div>
<div class="modal fade" id="createInstance" tabindex="-1" role="dialog" aria-labelledby="createLabel">
<div class="modal-dialog" role="document">
    <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="createLabel">Создать экземпляр</h4>
        </div>
        <form method="post" id="formCreate" action="javascript:void(null);">    
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-3"><b>Тип</b></div>
                    <div class="col-md-9"><label id="type" name="type"></label></div>
                </div>
                <hr>
                <div class="row">
                    <div class="col-md-3"><b>Название</b></div>
                    <div class="col-md-9"><input id="name" name="name" type="text" class="form-control pull-right" required></div>
                </div>
                <hr>
                <div class="row">
                    <div class="col-md-3"><b>Описание</b></div>
                    <div class="col-md-9"><textarea id="description" name="description" class="form-control pull-right" style="resize: vertical"></textarea></div>
                </div>
                <hr>
                <div class="row">
                    <div class="col-md-6"><input id="autostart" name="autostart" type="checkbox"> <label for="autostart"><b>Авто старт</b></label></div>
                    <div class="col-md-6"><input id="debug" name="debug" type="checkbox"><label for="debug"><b> Отладка</b></label></div>
                </div>
                <hr>
                <div class="row">
                    <div class="col-md-3"><b>Конфигурация</b></div>
                    <div class="col-md-9"><textarea id="config" name="config" rows='8' class="form-control pull-right" style="resize: vertical" required> {
}</textarea></div>
                </div>
                <hr>
                <div class="row">
                    <div class="col-md-3"><b>Конфигурация журнала</b></div>
                    <div class="col-md-9"><textarea id="logConfig" name="logConfig" rows='8' class="form-control pull-right" style="resize: vertical" required>
{
    "logLevel": "information",
    "formatter":
    {
        "pattern": "%Y-%m-%d %H:%M:%S %s: [%p] %t",
        "times": "local" 
    },
    "channel":
    {
        "rotation": "20M",
        "archive": "number",
        "compress": "true",
        "purgeCount": "5" 
    }
}</textarea></div>
                </div>
            </div>
        <div class="modal-footer">
            <a data-dismiss="modal" class="btn btn-primary pull-right" style="margin-left:3px; margin-right:3px;"><b>Отмена</b></a>
            <input type="submit" id="createAndStartBtn" value="Создать и запустить" class="btn btn-primary pull-right" style="margin-left:3px; margin-right:3px;">
            <input type="submit" id="createBtn" value="Создать" class="btn btn-primary pull-right" style="margin-left:3px; margin-right:3px;">
        </div>
        </form>
    </div>
</div>
</div>



<script src="/jquery.dataTables.min.js"></script>
<script src="/dataTables.bootstrap.min.js"></script>
<script>
$(document).ready(function() {
    var table = $("#agents").DataTable({
        "columns": [
            { "data": "NAME", "visible": false },
            { "data": "DISPLAYNAME" },
            { "data": "VERSION" },
            { "data": "TYPE" },
            { "data": "DESCRIPTION" },
            { "data": "CONFIG", "visible": false },
            { "data": "ADD_BUTTON", "orderable": false }
        ],
        "language": {
            "lengthMenu": "Показать _MENU_ элементов",
            "zeroRecords": "Ничего не найдено",
            "info": "С _START_ по _END_ из _TOTAL_",
            "infoEmpty": "Нет доступных данных",
            "infoFiltered": "(Отфильтровано из _MAX_ записей)",
            "paginate": {
                "first":      "Первый",
                "last":       "Последний",
                "next":       "Следующая",
                "previous":   "Предыдущая"
            },
            "loadingRecords": "Загрузка...",
            "processing":     "Обработка...",
            "search":         "Поиск:"
        }
    });

    $('#agents tbody').on( 'click', 'tr', function () {
        $(this).toggleClass('active');
    });
    
   $('#refreshBtn').click(function() {
        $.ajax({
            type: "GET",
            url: "/agentslist",
            contentType: "application/x-www-form-urlencoded",
            async: true,
            success: function (data) {
                if (data.ERROR) {
                    $('#alertMsg').empty();
                    $('#alertTmpl').tmpl(data).appendTo('#alertMsg');
                    $('#alertMsg').show();
                    return;
                }

                var rowsData = data.agents.map(function(item) {
                    item.ADD_BUTTON =
                        "<a style=\"style:none;\" title=\"Добавить экземпляр\" onclick=\"showModal(" +
                        "'" + item.NAME + "'" +
                        ")\"><span class=\"glyphicon glyphicon-plus\"></span></a>";
                    return item;
                });


                table.clear();
                table.rows.add(rowsData).draw(false);

                var pageInfo = table.page.info();
                if (pageInfo.page == pageInfo.pages) {
                    table.page('last').draw(false);
                }
            },
            error: function() {
                var errMsg = { "ERROR": "Ошибка при получении данных с сервера" };
                $('#alertMsg').empty();
                $('#alertTmpl').tmpl(errMsg).appendTo('#alertMsg');
                $('#alertMsg').show();
            }
        });
    });

    $('#deleteBtn').click(function() {
        var selectedNames = $.makeArray(table.rows('.active').data().map(function(dataRow) {
            return dataRow.NAME;
        }));

        if (!selectedNames.length) {
            return;
        }
        
        if (!confirm("Подтвердите, пожалуйста, удаление выбранных классов агентов.")) {
            return;
        }

        var jsonString = JSON.stringify({
            names: selectedNames
        });

        $.ajax({
            type: "POST",
            url: "/removeagent",
            data: jsonString,
            contentType: "application/x-www-form-urlencoded",
            async: true,
            success: function (data) {
                var errors = [];
                $.each(data, function(key, value){
                    if (value != "true") {
                        errors.push(key + ": " + value);
                    }
                });
                
                if (errors.length) {
                    var errMsg = { "ERROR": errors.join("\n") };
                    $('#alertMsg').empty();
                    $('#alertTmpl').tmpl(errMsg).appendTo('#alertMsg');
                    $('#alertMsg').show();
                } else {
                    $('#alertMsg').hide();
                }
                $('#refreshBtn').click();
            },
            error: function(data) {
                var errMsg = { "ERROR": "Ошибка при получении данных с сервера\n" + data };
                $('#alertMsg').empty();
                $('#alertTmpl').tmpl(errMsg).appendTo('#alertMsg');
                $('#alertMsg').show();
            },
            complete: function() {
                $('#refreshBtn').click();
            }
        });
    });

    $('#formCreate').submit(function(event) {
        $('#createBtn').prop("disabled", true);
        $('#createAndStartBtn').prop("disabled", true);

        var mg = {
            type: document.getElementById("type").innerHTML,
            name: $("#name").val(),
            description: $("#description").val(),
            autostart: document.getElementById("autostart").checked,
            debug: document.getElementById("debug").checked,
            config: $("#config").val(),
            logConfig: $("#logConfig").val(),
            startNow: document.activeElement.id == "createAndStartBtn"  
        };
        var jsonString = JSON.stringify(mg);
        var request = new XMLHttpRequest();
        request.open('POST', '/createinstance', true);
        request.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
        request.onload = function() {
            var resp = request.responseText;
            if(resp == "true") {
                showSuccess();
            } else {
                showError(resp);
            }
        }
        request.onerror = function() {
            showError();
        }
        request.send(jsonString);
    });
    
    function showSuccess() {
        $('#alertMsg').removeClass('alert-danger');
        $('#alertMsg').addClass('alert-success');
        document.getElementById('alertMsg').innerHTML = '<a class="close" data-dismiss="alert" href="#">&times;</a>' +
        'Экземпляр  ' + document.getElementById("type").innerHTML + ' успешно создан';
        $('#alertMsg').show();
        $("#createInstance").modal('hide');
        $('#formCreate').trigger( 'reset' );
    }

    function showError(data) {
        $('#alertMsg').addClass('alert-danger');
        $('#alertMsg').removeClass('alert-success');
        document.getElementById('alertMsg').innerHTML = '<a class="close" data-dismiss="alert" href="#">&times;</a>' +
        'Возникла ошибка при создании экземпляра: ' + data;
        $('#alertMsg').show();
        $("#createInstance").modal('hide');
        $('#formCreate').trigger( 'reset' );
    }

});

    function showModal(name) {
        var table = $('#agents').DataTable();
        
        // TODO: fix the code below
        // it doesn't work in case of sorting
        // the returned index is correct - selected row in case of sorted table or not 
        // however, data array itself is not sorted =\
        // cache() method returnes undefined value by unknown reason
        //var index = table.column(0).data().indexOf(name);
        //if (index < 0) {
        //    return;
        //}
        //config = table.cell(index, 5).data();
        
        // use workaround
        var config;
        table.rows().every( function ( rowIdx, tableLoop, rowLoop ) {
            var data = this.data();
            if (data.NAME == name) {
                config = data.CONFIG;
                // return ?
            }
        } );

        document.getElementById("type").innerHTML = name;
        document.getElementById("config").innerHTML = config;

        $('#createBtn').prop("disabled", false);
        $('#createAndStartBtn').prop("disabled", false);
        $("#createInstance").modal('show');
    }
</script>
<link rel="stylesheet" href="/css/jquery.fileupload.css">
<script src="js/vendor/jquery.ui.widget.js"></script>
<script src="js/jquery.iframe-transport.js"></script>
<script src="js/jquery.fileupload.js"></script>
<script src="/jquery.tmpl.js" type="text/javascript"></script>
<script id="installSuccess" type="text/x-jquery-tmpl">
<div>
    <i class="glyphicon glyphicon-ok text-green"></i>&nbsp;${FILE}
</div>
</script>
<script id="installError" type="text/x-jquery-tmpl">
<div>
    <i class="glyphicon glyphicon-remove text-red"></i>&nbsp;${FILE}&nbsp;-&nbsp;${ERROR}
</div>
</script>
<script id="alertTmpl" type="text/x-jquery-tmpl">
    <div class="alert alert-danger alert-dismissible">
        <h4><i class="glyphicon glyphicon-ban-circle"></i> Ошибка!</h4>
<pre class="alert alert-danger">${ERROR}</pre>
    </div>
</script>
<span class="btn btn-success fileinput-button">
    <i class="glyphicon glyphicon-plus"></i>
    <span>Установить агенты...</span>
    <input id="fileupload" type="file" name="files[]" data-url="/installagent" multiple>
</span>
<div id="progress">
    <div class="bar" style="width: 0%"></div>
</div>
<div id="installResults">
</div>
<script>
$(function () {
    $('#fileupload').fileupload({
        dataType: 'json',
        sequentialUploads: true,
        progressall: function (e, data) {
            var progress = parseInt(data.loaded / data.total * 100, 10);
            $('#progress .bar').css('width', progress + '%');
        },
        start: function(e) {
            $('#fileupload').prop("disabled", true);
            $('#installResults').empty();
        },
        stop: function(e) {
            $('#fileupload').prop("disabled", false);
            $('#refreshBtn').click();
        },
        always: function (e, data) {
            var response = jQuery.parseJSON(data.jqXHR.responseText);
            if (response.success) {              
                $('#installSuccess').tmpl({"FILE": data.files[0].name}).appendTo('#installResults');
            } else {
                $('#installError').tmpl({"FILE": data.files[0].name, "ERROR": response.error}).appendTo('#installResults');
            }
        }
    });
});
</script>
			</div><!-- /.content-wrapper -->
	    </section><!-- ./content -->
    </div><!-- ./wrapper -->
  </body>
</html>
